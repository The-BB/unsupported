From 2137c742c2786f79ab0515d5283fdb59784c573e Mon Sep 17 00:00:00 2001
From: Ozzieisaacs <ozzie.fernandez.isaacs@googlemail.com>
Date: Sun, 8 Aug 2021 12:59:57 +0200
Subject: [PATCH 129/150] Fix for nitroflare with hcaptcha

---
 src/pyload/plugins/downloaders/NitroflareCom.py | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

--- a/src/pyload/plugins/downloaders/NitroflareCom.py
+++ b/src/pyload/plugins/downloaders/NitroflareCom.py
@@ -5,6 +5,7 @@ import re
 
 from pyload.core.network.request_factory import get_url
 
+from ..anticaptchas.HCaptcha import HCaptcha
 from ..anticaptchas.ReCaptcha import ReCaptcha
 from ..base.simple_downloader import SimpleDownloader
 
@@ -12,7 +13,7 @@ from ..base.simple_downloader import Sim
 class NitroflareCom(SimpleDownloader):
     __name__ = "NitroflareCom"
     __type__ = "downloader"
-    __version__ = "0.30"
+    __version__ = "0.31"
     __status__ = "testing"
 
     __pattern__ = r"https?://(?:www\.)?(?:nitro\.download|nitroflare\.com)/view/(?P<ID>[\w^_]+)"
@@ -79,6 +80,8 @@ class NitroflareCom(SimpleDownloader):
 
         recaptcha = ReCaptcha(pyfile)
         recaptcha_key = recaptcha.detect_key()
+        hcaptcha = HCaptcha(pyfile)
+        hcaptcha_key = hcaptcha.detect_key()
 
         self.data = self.load(
             "http://nitroflare.com/ajax/freeDownload.php",
@@ -95,7 +98,10 @@ class NitroflareCom(SimpleDownloader):
             self.captcha = recaptcha
             response, _ = self.captcha.challenge(recaptcha_key)
             inputs["g-recaptcha-response"] = response
-
+        elif hcaptcha_key:
+            self.captcha = hcaptcha
+            response = self.captcha.challenge(hcaptcha_key)
+            inputs["g-recaptcha-response"] = inputs["h-captcha-response"] = response
         else:
             response = self.captcha.decrypt(
                 "http://nitroflare.com/plugins/cool-captcha/captcha.php"
