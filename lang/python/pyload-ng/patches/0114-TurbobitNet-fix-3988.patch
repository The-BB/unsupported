From 501faddf4bb49695420643f34359ce0c0715b3c4 Mon Sep 17 00:00:00 2001
From: GammaC0de <gammac0de@users.noreply.github.com>
Date: Tue, 22 Jun 2021 23:03:44 +0300
Subject: [PATCH 114/150] [TurbobitNet] fix #3988

---
 src/pyload/plugins/downloaders/TurbobitNet.py | 18 +++++++-----------
 1 file changed, 7 insertions(+), 11 deletions(-)

--- a/src/pyload/plugins/downloaders/TurbobitNet.py
+++ b/src/pyload/plugins/downloaders/TurbobitNet.py
@@ -5,14 +5,14 @@ import re
 import pycurl
 from pyload.core.utils.misc import eval_js
 
-from ..anticaptchas.ReCaptcha import ReCaptcha
+from ..anticaptchas.HCaptcha import HCaptcha
 from ..base.simple_downloader import SimpleDownloader
 
 
 class TurbobitNet(SimpleDownloader):
     __name__ = "TurbobitNet"
     __type__ = "downloader"
-    __version__ = "0.37"
+    __version__ = "0.38"
     __status__ = "testing"
 
     __pattern__ = r'https?://(?:(?:www|m)\.)?(?:turbobit\.net|turbo?\.(?:to|cc))/(?:download/free/)?(?P<ID>\w+)'
@@ -88,18 +88,14 @@ class TurbobitNet(SimpleDownloader):
                 self.link = "https://turbobit.net{}".format(m.group(1))
 
     def solve_captcha(self):
-        action, inputs = self.parse_html_form("action='#'")
-        if not inputs:
+        action, inputs = self.parse_html_form("id='form-captcha'")
+        if inputs is None:
             self.fail(self._("Captcha form not found"))
 
-        if inputs["captcha_type"] == "recaptcha2":
-            self.captcha = ReCaptcha(self.pyfile)
-            inputs["g-recaptcha-response"], challenge = self.captcha.challenge()
+        self.captcha = HCaptcha(self.pyfile)
+        inputs["g-recaptcha-response"] = inputs["h-captcha-response"] = self.captcha.challenge()
 
-        else:
-            self.fail(self._("Unknown captcha type"))
-
-        self.data = self.load(self.free_url, post=inputs)
+        self.data = self.load(self.free_url, post=inputs, ref=self.free_url)
 
     def handle_premium(self, pyfile):
         m = re.search(self.LINK_PREMIUM_PATTERN, self.data)
